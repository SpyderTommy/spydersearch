<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SpyderSearch</title>
<link rel="icon" href="favicon.png" type="image/png">
<style>
  :root{
    --bg:#121212; --card:#202124; --muted:#9aa0a6; --text:#e8eaed; --accent:#8ab4f8;
  }
  html,body{height:100%; margin:0;}
  body{
    background:var(--bg);
    color:var(--text);
    font-family: Arial, Helvetica, sans-serif;
    text-align:center;
    transition:opacity 1.2s ease;
    opacity:0;
    -webkit-font-smoothing:antialiased;
  }
  body.loaded{opacity:1;}

  /* Logo */
  #logo { margin-top:120px; transition:transform .35s ease, opacity 1s; cursor:pointer; }
  #logo img{ width:360px; max-width:86vw; display:block; margin:0 auto; }

  /* Search */
  #searchbox { margin-top:26px; }
  #query {
    width:520px; max-width:86vw; height:40px; border-radius:24px; padding:8px 16px;
    background:var(--card); border:1px solid #333; color:var(--text); outline:none; font-size:16px;
    transition: box-shadow .18s ease, border-color .18s ease;
  }
  #query:focus{ box-shadow:0 6px 20px rgba(0,0,0,0.6); border-color:rgba(138,180,248,0.18); }

  .btn-row{ margin-top:16px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap; }
  .btn{
    padding:10px 18px; border-radius:6px; border:1px solid #333; background:#2b2b2d; color:var(--text);
    font-size:14px; cursor:pointer; transition: transform .08s ease, background .12s ease;
  }
  .btn:hover{ transform:translateY(-3px); background:#343539; }

  /* Shortcuts */
  #shortcuts-wrap{ margin-top:44px; display:flex; justify-content:center; }
  #shortcuts{
    max-width:760px; width:100%; display:flex; flex-wrap:wrap; gap:22px; justify-content:center; padding:0 12px;
  }

  .tile{
    width:92px; height:92px; border-radius:12px; display:flex; flex-direction:column; align-items:center;
    justify-content:center; gap:6px; background:transparent; cursor:grab; user-select:none; position:relative;
    transition: transform .18s ease, background .12s ease;
  }
  .tile:active{ cursor:grabbing; transform:scale(.98); }
  .tile:hover{ background: rgba(255,255,255,0.03); transform:translateY(-6px); }

  .icon{
    width:52px; height:52px; border-radius:50%; background:var(--card); display:flex; align-items:center; justify-content:center; overflow:hidden;
    transition: transform .15s ease, box-shadow .15s;
  }
  .icon img{ width:40px; height:40px; object-fit:cover; border-radius:50%; display:block; }
  .label{ font-size:13px; color:var(--text); opacity:.95; max-width:86px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

  /* tiny action buttons that appear when hovering */
  .tile .action {
    display:none;
    position:absolute; top:6px; width:28px; height:28px; border-radius:6px; background:rgba(0,0,0,0.45); border:1px solid rgba(255,255,255,0.04);
    color:var(--muted); font-size:13px; align-items:center; justify-content:center; cursor:pointer;
  }
  .tile:hover .action { display:flex; }
  .action.edit{ left:6px; } .action.remove{ right:6px; }

  /* Add tile */
  .add-tile{
    width:92px; height:92px; border-radius:12px; display:flex; flex-direction:column; align-items:center; justify-content:center;
    border:1px dashed rgba(255,255,255,0.06); color:var(--muted); cursor:pointer; transition: background .12s;
  }
  .add-tile:hover{ background: rgba(255,255,255,0.02); color:var(--text); }

  /* playful drag visual */
  .dragging{
    transform: scale(1.12) rotate(3deg); filter:brightness(1.2); box-shadow:0 18px 60px rgba(0,0,0,0.7);
  }
  .drag-target{ animation: glowPulse .6s ease infinite alternate; }
  @keyframes glowPulse{ from{ box-shadow:0 0 0 rgba(138,180,248,0.08);} to{ box-shadow:0 0 12px rgba(138,180,248,0.18); } }

  /* modal - frosted glass */
  .modal-backdrop{ display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); backdrop-filter: blur(10px); z-index:2000; align-items:center; justify-content:center; }
  .modal-backdrop.show{ display:flex; }
  .modal {
    width:320px; background: rgba(28,29,30,0.86); border-radius:12px; padding:16px; color:var(--text);
    box-shadow:0 18px 60px rgba(0,0,0,0.7); transform: translateY(-6px) scale(.98); opacity:0; transition: transform .22s cubic-bezier(.2,.9,.3,1), opacity .18s;
  }
  .modal.show{ transform: translateY(0) scale(1); opacity:1; }
  .modal h3{ margin:0 0 10px 0; font-size:16px; }
  .modal label{ display:block; font-size:13px; color:var(--muted); margin-top:8px; }
  .modal input[type="text"], .modal input[type="url"]{
    width:100%; padding:8px; margin-top:6px; border-radius:8px; background:#151515; border:1px solid #333; color:var(--text);
  }
  .modal .row{ display:flex; justify-content:flex-end; gap:8px; margin-top:12px; }
  .btn-ghost{ background:#2b2b2d; border:1px solid #3c3c3c; color:var(--text); padding:8px 12px; border-radius:8px; cursor:pointer; }
  .btn-save{ background:var(--accent); border:none; color:#000; padding:8px 12px; border-radius:8px; cursor:pointer; transition: box-shadow .12s; }
  .btn-save:hover{ box-shadow:0 8px 24px rgba(138,180,248,0.12); }

  /* centered context menu (frosted) */
  #context-centered { display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); z-index:2100; width:240px; }
  #context-centered .card{ padding:10px; border-radius:10px; background:rgba(26,27,28,0.86); backdrop-filter: blur(8px); box-shadow:0 12px 40px rgba(0,0,0,0.6); }
  #context-centered button{ width:100%; text-align:left; padding:10px; border:none; background:transparent; color:var(--text); font-size:14px; cursor:pointer; border-radius:6px; }
  #context-centered button:hover{ background:rgba(255,255,255,0.02); color:var(--accent); }

  footer{ position:fixed; bottom:18px; width:100%; text-align:center; color:var(--muted); font-size:13px; }
  @media(max-width:520px){ #query{ width:88vw; } .tile{ width:80px; height:80px;} .icon{width:48px;height:48px;} }
</style>
</head>
<body>
  <div id="logo" title="Go to DragonX">
    <img src="https://github.com/SpyderTommy/spydersearch/blob/main/SpyderLogo.png?raw=true" alt="SpyderSearch Logo" />
  </div>

  <form id="searchbox" onsubmit="handleSearch(event)">
    <input id="query" type="text" placeholder="Search SpyderSearch..." autocomplete="off" />
    <div class="btn-row">
      <button type="submit" class="btn">Spyder Search</button>
      <button type="button" id="lucky" class="btn">I'm Feeling Lucky</button>
    </div>
  </form>

  <div id="status" aria-live="polite"></div>

  <div id="shortcuts-wrap">
    <div id="shortcuts" role="list"></div>
  </div>

  <footer>Â© SpyderGurt 2025</footer>

  <!-- Add/Edit modal (frosted) -->
  <div id="modal-backdrop" class="modal-backdrop" aria-hidden="true">
    <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <h3 id="modal-title">Add shortcut</h3>
      <label for="sc-name">Name</label>
      <input id="sc-name" type="text" placeholder="Name (e.g. Google)">
      <label for="sc-url">URL</label>
      <input id="sc-url" type="url" placeholder="https://example.com">
      <label for="sc-img">Icon image URL (optional)</label>
      <input id="sc-img" type="url" placeholder="https://.../favicon.png">
      <div class="row">
        <button class="btn-ghost" id="modal-cancel">Cancel</button>
        <button class="btn-save" id="modal-save">Save</button>
      </div>
    </div>
  </div>

  <!-- Centered context menu (frosted) -->
  <div id="context-centered" role="menu" aria-hidden="true">
    <div class="card">
      <button id="context-edit">Edit</button>
      <button id="context-remove">Remove</button>
    </div>
  </div>

<script>
/* ---------- Helpers & storage ---------- */
const LOGO_URL = "http://spydertacos.space/DragonX_V4.html";
const STORAGE_KEY = "spyder_shortcuts_v3";

function loadShortcuts(){
  try{
    return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
  }catch(e){ return []; }
}
function saveShortcuts(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}

/* ---------- UI elements ---------- */
const body = document.body;
window.addEventListener('load', ()=> body.classList.add('loaded'));

const logo = document.querySelector('#logo img');
logo.addEventListener('click', ()=> window.location.href = LOGO_URL);

const queryEl = document.getElementById('query');
const statusEl = document.getElementById('status');
const shortcutsEl = document.getElementById('shortcuts');

const modalBackdrop = document.getElementById('modal-backdrop');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modal-title');
const scName = document.getElementById('sc-name');
const scUrl = document.getElementById('sc-url');
const scImg = document.getElementById('sc-img');
const btnSave = document.getElementById('modal-save');
const btnCancel = document.getElementById('modal-cancel');

const contextCentered = document.getElementById('context-centered');
const ctxEdit = document.getElementById('context-edit');
const ctxRemove = document.getElementById('context-remove');

const luckyBtn = document.getElementById('lucky');
luckyBtn.addEventListener('click', ()=> window.location.href = "https://en.wikipedia.org/wiki/Cheese");

/* ---------- App state ---------- */
let shortcuts = loadShortcuts();
// ensure defaults if empty
if(shortcuts.length === 0){
  shortcuts = [
    { name:"Google", url:"https://www.google.com", img:"https://www.google.com/s2/favicons?sz=64&domain_url=https://www.google.com" },
    { name:"YouTube", url:"https://www.youtube.com", img:"https://www.google.com/s2/favicons?sz=64&domain_url=https://www.youtube.com" },
    { name:"Blooket", url:"https://blooket.com", img:"https://www.google.com/s2/favicons?sz=64&domain_url=https://blooket.com" },
    { name:"Kahoot", url:"https://kahoot.it", img:"https://www.google.com/s2/favicons?sz=64&domain_url=https://kahoot.it" },
  ];
  saveShortcuts(shortcuts);
}
let dragIndex = null;
let editingIndex = null;
let contextIndex = null;

/* ---------- Render ---------- */
function renderShortcuts(){
  shortcutsEl.innerHTML = "";
  shortcuts.forEach((s, i) => {
    const tile = document.createElement('div');
    tile.className = 'tile';
    tile.draggable = true;
    tile.dataset.index = i;

    // build DOM
    const actionEdit = document.createElement('button');
    actionEdit.className = 'action edit';
    actionEdit.title = 'Edit';
    actionEdit.innerText = 'âœï¸';
    actionEdit.addEventListener('click', (ev)=> {
      ev.stopPropagation();
      openEdit(i);
    });

    const actionRemove = document.createElement('button');
    actionRemove.className = 'action remove';
    actionRemove.title = 'Remove';
    actionRemove.innerText = 'ðŸ—‘ï¸';
    actionRemove.addEventListener('click', (ev)=> {
      ev.stopPropagation();
      removeShortcut(i);
    });

    const iconWrap = document.createElement('div');
    iconWrap.className = 'icon';
    const img = document.createElement('img');
    img.alt = s.name || "shortcut";
    // prefer provided image; fallback to site's favicon via google s2 domain service
    img.src = s.img && s.img.trim() ? s.img : ('https://www.google.com/s2/favicons?sz=64&domain_url=' + encodeURIComponent(s.url));
    img.onerror = () => { img.src = 'https://www.google.com/s2/favicons?sz=64&domain_url=' + encodeURIComponent(s.url); };
    iconWrap.appendChild(img);

    const label = document.createElement('div');
    label.className = 'label';
    label.innerText = s.name;

    tile.appendChild(actionEdit);
    tile.appendChild(actionRemove);
    tile.appendChild(iconWrap);
    tile.appendChild(label);

    // click opens in new tab
    iconWrap.addEventListener('click', (ev)=> {
      ev.stopPropagation();
      window.open(s.url, '_blank', 'noopener');
    });
    label.addEventListener('click', (ev)=> {
      ev.stopPropagation();
      window.open(s.url, '_blank', 'noopener');
    });

    // drag handlers
    tile.addEventListener('dragstart', (ev)=>{
      dragIndex = Number(tile.dataset.index);
      tile.classList.add('dragging');
      ev.dataTransfer.effectAllowed = 'move';
      try{ ev.dataTransfer.setData('text/plain', 'drag'); }catch(e){}
    });
    tile.addEventListener('dragend', ()=>{
      dragIndex = null;
      tile.classList.remove('dragging');
      removeDragTargets();
    });
    tile.addEventListener('dragover', (ev)=>{
      ev.preventDefault();
    });
    tile.addEventListener('dragenter', ()=>{
      if(!tile.classList.contains('drag-target')) tile.classList.add('drag-target');
    });
    tile.addEventListener('dragleave', ()=> tile.classList.remove('drag-target'));
    tile.addEventListener('drop', (ev)=>{
      ev.preventDefault();
      tile.classList.remove('drag-target');
      if(dragIndex === null) return;
      const to = Number(tile.dataset.index);
      if(dragIndex === to) return;
      const item = shortcuts.splice(dragIndex,1)[0];
      shortcuts.splice(to,0,item);
      saveShortcuts(shortcuts);
      renderShortcuts();
    });

    // right-click opens centered context menu (not native menu)
    tile.addEventListener('contextmenu', (ev)=>{
      ev.preventDefault();
      contextIndex = i;
      openContextCentered();
    });

    shortcutsEl.appendChild(tile);
  });

  // add tile
  const add = document.createElement('div');
  add.className = 'add-tile';
  add.innerHTML = `<div style="font-size:28px;line-height:1">+</div><div style="font-size:12px;margin-top:6px;color:var(--muted)">Add</div>`;
  add.addEventListener('click', ()=> openAdd());
  shortcutsEl.appendChild(add);
}

/* ---------- Drag helpers ---------- */
function removeDragTargets(){
  document.querySelectorAll('.drag-target').forEach(n => n.classList.remove('drag-target'));
}

/* ---------- Shortcuts CRUD ---------- */
function openAdd(){
  editingIndex = null;
  modalTitle.innerText = "Add shortcut";
  scName.value = ""; scUrl.value = ""; scImg.value = "";
  showModal();
}
function openEdit(i){
  editingIndex = i;
  modalTitle.innerText = "Edit shortcut";
  const s = shortcuts[i];
  scName.value = s.name || "";
  scUrl.value = s.url || "";
  scImg.value = s.img || "";
  showModal();
}
function removeShortcut(i){
  if(!confirm(`Remove "${shortcuts[i].name}"?`)) return;
  shortcuts.splice(i,1);
  saveShortcuts(shortcuts);
  renderShortcuts();
}
function saveShortcutFromModal(){
  const name = scName.value.trim();
  const url = scUrl.value.trim();
  const img = scImg.value.trim();
  if(!name || !url){ alert("Please provide a name and URL."); return; }
  // normalize url (add https if missing)
  let normalized = url;
  if(!/^[a-zA-Z][a-zA-Z\d+\-.]*:\/\//.test(normalized)) normalized = "https://" + normalized;
  const obj = { name, url: normalized, img };
  if(editingIndex !== null && typeof editingIndex === 'number'){
    shortcuts[editingIndex] = obj;
  } else {
    shortcuts.push(obj);
  }
  saveShortcuts(shortcuts);
  hideModal();
  renderShortcuts();
}
function saveShortcuts(arr){ saveShortcutsToStorage(arr || shortcuts); }
function saveShortcutsToStorage(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
  shortcuts = arr;
}

/* ---------- Modal controls ---------- */
function showModal(){
  modalBackdrop.classList.add('show');
  modal.classList.add('show');
  modalBackdrop.setAttribute('aria-hidden','false');
  setTimeout(()=> scName.focus(), 160);
}
function hideModal(){
  modalBackdrop.classList.remove('show');
  modal.classList.remove('show');
  modalBackdrop.setAttribute('aria-hidden','true');
  editingIndex = null;
}

/* ---------- Centered context menu (frosted) ---------- */
function openContextCentered(){
  contextCentered.style.display = 'block';
  contextCentered.setAttribute('aria-hidden','false');
}
function closeContextCentered(){
  contextCentered.style.display = 'none';
  contextCentered.setAttribute('aria-hidden','true');
}

/* ---------- Events ---------- */
btnSave.addEventListener('click', saveShortcutFromModal);
btnCancel.addEventListener('click', hideModal);
modalBackdrop.addEventListener('click', (ev)=>{ if(ev.target === modalBackdrop) hideModal(); });

ctxEdit.addEventListener('click', ()=>{
  closeContextCentered();
  if(contextIndex != null) openEdit(contextIndex);
});
ctxRemove.addEventListener('click', ()=>{
  closeContextCentered();
  if(contextIndex != null) removeShortcut(contextIndex);
});

// keyboard: esc to close modals
document.addEventListener('keydown', (ev)=>{
  if(ev.key === 'Escape'){ hideModal(); closeContextCentered(); }
});

/* ---------- Search & Easter eggs ---------- */
function handleSearch(e){
  e.preventDefault();
  const q = (queryEl.value || "").trim().toLowerCase();
  statusEl.textContent = "Searching...";
  statusEl.classList.add('visible');

  if(q.includes("denaho")){
    showTemporary("Denaho is better than Elian");
    return;
  }
  if(q.includes("elian") || q === "lower"){
    showTemporary("gurt yo");
    setTimeout(()=> window.location.href = "https://youtu.be/w5BnMKOG33M?si=5iOsEG16GPKmJSIZ", 3500);
    return;
  }
  if(q === "do a barrel roll"){
    document.body.style.animation = "barrelRoll 1s linear";
    setTimeout(()=> document.body.style.animation = "", 1000);
    return;
  }
  if(q === "do a barrel roll x10" || q === "do a barrel roll 10"){
    let spins=0;
    document.body.style.animation = "barrelRoll .6s linear infinite";
    const iv = setInterval(()=>{ spins++; if(spins>=10){ clearInterval(iv); document.body.style.animation = ""; } }, 600);
    return;
  }
  if(q.includes("blooket bot")) { window.location.href = "https://blooketbot.schoolcheats.net/"; return; }
  if(q.includes("kahoot bot")) { window.location.href = "https://kahootbot.net"; return; }
  if(q.includes("blox fruits peak")) { window.location.href = "https://www.youtube.com/watch?v=z-i1pAF6FjE"; return; }
  if(q.includes("the weeknd peak")) { window.location.href = "https://youtu.be/4NRXx6U8ABQ?si=0NekiZ0x0ffKA4b0"; return; }
  if(q.includes("cabrera")){ showTemporary("She sucks, don't search that ever again."); return; }

  // default: go to results page (local results.html expected)
  window.location.href = `results.html?q=${encodeURIComponent(q)}`;
}
document.getElementById('searchbox').addEventListener('submit', handleSearch);

function showTemporary(txt, ms=3800){
  statusEl.textContent = txt;
  setTimeout(()=> { statusEl.textContent = ""; statusEl.classList.remove('visible'); }, ms);
}

/* ---------- Init ---------- */
renderShortcuts();

/* ensure clicks outside context menu close it */
document.addEventListener('click', (ev)=>{
  if(contextCentered.style.display === 'block'){
    // if click inside context-centered card ignore, else close
    if(!contextCentered.contains(ev.target)) closeContextCentered();
  }
});
</script>
</body>
</html>
